---
layout: single
title: "[vueJS] vueJS 구현에 관한 사항 2"
excerpt: "nuxt.config.js 설정 사항"

categories:
  - tech
tags:
  - [vudJS]

toc: false
toc_sticky: true

date: 2023-01-30
last_modified_at: 2023-01-30
---

# nuxt.config.js 설정 사항
  
# 1. loading 화면 만들기

- nuxt.config.js에 아래 코드 추가.

```json
  loading: '~/components/loading.vue',
```

- 로딩화면 출력

```javascript
  this.$nuxt.$loading.start();
```

- 로딩화면 종료

```javascript
  this.$nuxt.$loading.finish();
```
  

# 2. Cookie 모듈

- 클라이언트에서 모두 쿠키를 사용할 수 있도록 지원.
- cookie-universal-nuxt 모듈 사용 옵션을 지정. 

### 2-1. 설치
- yarn: yarn add cookie-universal-nuxt
- npm: npm i --save cookie-universal-nuxt

### 2-2. Add cookie-universal-nuxt to nuxt.config.js

```json
  {
    //  To make it work for SSR, remember to set `ssr: true` and `target: 'server'`
    ssr: true,
    target: 'server',
    modules: [
      // Simple usage
      'cookie-universal-nuxt',
      // With options
      ['cookie-universal-nuxt', { alias: 'cookiz' }],
    ]
  }
```

> https://nuxtjs.org/docs/directory-structure/modules/

```json
  export default {
    nuxt: {
      useCookie: {
        // 플러그인 이름을 지정할 수 있다.
        alias: 'cookiz',
        // JSON 형태로 쿠키를 저장하고. parsing 할지 여부
        parseJSON: true
      }
    }
  }
```

- 사용법 : https://www.npmjs.com/package/cookie-universal-nuxt
- 쿠키 모듈의 기본 플러그인 명은 cookies 이며, 아래와 같이 쿠키기능 사용가능.

```javascript
  this.$cookies.set('testCookie', 'testValue', {
    path: '/',
    expires: new Date(),
    maxAge: -1,
    httpOnly: true,
    domain: 'localhost',
    encode: true,
    sameSite: 'none',
    secure: true
  });

  this.$cookies.get('testCookie');

  this.$cookies.remove('testCookie');
```
#### 참고.1

```json
  buildModules: [
    // https://go.nuxtjs.dev/eslint
    '@nuxtjs/eslint-module',
    '@nuxtjs/device',
    '@nuxtjs/gtm',
    ['@nuxtjs/dotenv', {}],
    ['cookie-universal-nuxt', { alias: 'cookiz' }],
    '@nuxtjs/style-resources'
  ],
```
  

# 3. GTM(Google Tag Manager)

- Nuxt(SPA) + Firebase 에서 Google Tag Manager를 이용해 page_view 이벤트를 커스텀
- Nuxt와 Firebase로 구성되어 있는 앱에 analytics가 활성화 되어 있어도 SPA에서는 페이지의 이동이 javascript에 의해 이루어지므로 페이지의 로드 없이 이루어짐
- 페이지뷰 이벤트를 측정을 위해 GTM 사용

 
### 3-1. 기존에 활성화 되어있던 analytics가 있다면 삭제
- gtm으로 page_view이벤트를 커스텀 하려고 한다면 이중측정이 되어 버리기 때문에 삭제필요

```javascript
  firebase.analytics()
```
 
### 3-2. @nuxtjs/google-tag-manager를 설치, 셋팅
- npm install @nuxtjs/google-tag-manager
- nuxt.config.js에 이하의 코드를 삽입

```json
  modules: [
    ['@nuxtjs/google-tag-manager', { id: 'GTM-xxxxxx', pageTracking: true }]
  ],
```  

- pageTracking을 true로 함으로써 이하의 initPageTraking 함수가 router에서 페이지 이동을 할 때 이벤트가 발생.

```javascript
init() {
    window[this.options.layer] = window[this.options.layer] || []

    this.pushEvent({
      event: 'gtm.js',
      'gtm.start': new Date().getTime()
    })

    if (this.options.pageTracking && (!this.options.respectDoNotTrack || !this.hasDNT())) {
      this.initPageTracking()
    }
  }

  initPageTracking() {
    this.ctx.app.router.afterEach((to, from) => {
      setTimeout(() => {
        window[this.options.layer].push(to.gtm || { event: this.options.pageViewEventName, pageType: 'PageView', pageUrl: to.fullPath, routeName: to.name })
      }, 0)
    })
  }
  ...이하 생략
}
```

### 3-3. google tag manager에서 커스텀 이벤트를 등록
- 이하 https://heewon26.tistory.com/400 참조

#### 참고. 1

```json
  buildModules: [
    // https://go.nuxtjs.dev/eslint
    '@nuxtjs/eslint-module',
    '@nuxtjs/device',
    '@nuxtjs/gtm',
    ['@nuxtjs/dotenv', {}],
    ['cookie-universal-nuxt', { alias: 'cookiz' }],
    '@nuxtjs/style-resources'
  ],

  gtm: {
    enabled: true,
    debug: true,
    id: 'GTM-NXZPHVG',
    layer: 'dataLayer',
    pageTracking: true,
    autoInit: true
  },

```
  

# 4. Validation (Vee-Validate)

### 4-1. vee-validation 설치. 

```bash
  npm install vee-validate --save
```

### 4-2. validation.js 생성
- 설치 후 플러그인으로 사용하기 위해 plugins 폴더에 validation.js 파일을 생성.

 ```javascript
  // plugins/validation.js
  import Vue from 'vue'
  import 'babel-polyfill'
  import * as rules from 'vee-validate/dist/rules'
  import { extend, ValidationObserver, ValidationProvider } from 'vee-validate'

  extend('required', {
    ...rules.required,
    message: '{_field_} 필드는 필수 값 입니다.'
  })
  extend('email', {
    ...rules.email,
    message: '{_field_} 필드가 유효하지 않습니다.'
  })
  extend('numeric', {
    ...rules.numeric,
    message: '{_field_} 필드는 숫자만 입력 가능합니다.'
  })
  extend('min', {
    validate (value, { length }) {
      return String(value).length >= length
    },
    params: ['length'],
    message: '{_field_} 필드의 문자 개수는 {length}자 이상만 허용됩니다..'
  })

...

  extend('phone', {
    validate: (value) => {
      const regex = /^01([0|1|6|7|8|9])-?([0-9]{3,4})-?([0-9]{4})$/.test(value)
      return regex
    },
    message: '{_field_} 필드가 유효하지 않습니다'
  })

  export const extender = namespace => (rule, schema) => {
    extend(namespace + '/' + rule, schema)
  }
  // require('@/validations/member').default(extender('mb'))
  export const install = (context, inject) => {
    Vue.component('ValidationProvider', ValidationProvider)
    Vue.component('ValidationObserver', ValidationObserver)
  }
  export default install
```

- import 구문을 통해 Vue, ValidationProvider, ValidationObserver, extend 등을 설정
- vee-validate/dist/rules에서 rules를 설정

### 4-3 nuxt.config.js 수정
- 기본적으로 Nuxt.js는 node_modules 폴더의 트랜스파일을 무시하기 때문에 트랜스파일 목록에 추가해줘야 한다. 
  - nuxt.config.js 파일에 아래처럼 코드를 추가필요.

```json
  build: {
    transpile: [/^element-ui/, 'vee-validate/dist/rules']
  },
```

### 4-4. 사용법
- ValidationProvider: 검증할 요소 (input 등)을 감싸 검증을 도와준다.
- ValidationObserver: 양식 전체의 요소를 검증할 수 있도록 도와준다. (하위 요소로 ValidationProvider를 여러개 둘 수 있음)
- Object(keys) 구문은 가져온 모든 rules를 foreach로 하나씩 extend하여 규칙을 사용할 수 있게 해준다. 

```html
  <ValidationProvider v-slot="{ errors }" rules="required">
    <input v-model="test" type="text" />
    <span>{{ errors[0] }}</span>
  </ValidationProvider>
```
  

# 5. 다국어 적용

### 5-1. 설치

```
  $ yarn add @nuxtjs/i18n
```

### 5-2. plugins로 type 확장
- tsconfig.json (jsconfig.json ?)

```json
  {
    "compilerOptions": {
      "types": [
        "@nuxt/types",
        "@nuxtjs/i18n",
      ]
    }
  }
```

### 5-3. nuxt.confing.js 수정

```json
  modules: [
    '@nuxtjs/axios',
    [
      '@nuxtjs/i18n',
      {
        // 대응할 언어들 셋팅
        locales: [
          { code: 'ko', name: 'Korean', iso: 'ko_KR', file: 'ko/index.js' },
          { code: 'ja', name: 'Japanese', iso: 'ja_JP', file: 'ja/index.js' },
        ],
        defaultLocale: 'ko',
        langDir: 'locales/',
        strategy: 'prefix_except_default',
        vueI18n: {
          fallbackLocale: 'ko',
        },
        lazy: true,
        vueI18nLoader: true,
        vuex: false,
      },
    ],
  ],
```

### 5-4. locales 언어별 파일생성

- locales 디렉터리에 언어별 파일생성

```json
// ko/index.js
export default {
  dayLabels: ['일', '월', '화', '수', '목', '금', '토'],
}

// ja/index.js
export default {
  dayLabels: ['日', '月', '火', '水', '木', '金', '土'],
}
```

### 5-5. 사용법

```html
  <div class="flex">
    <div v-for="(day, i) in $t('dayLabels')" :key="i">
      {{ day }}
    </div>
  </div>
```

#### 참고 1. DB를 이용한 다국어처리

- main.js 수정

```javascript
import Vue from 'vue'
import VueI18n from 'vue-i18n'
import _ from 'lodash'
import axios from '@/axios' // server에 data 요청을 하기 위해서 사용하므로 사용자 환경에 맞게 수정

async function setI18n () {
  Vue.use(VueI18n)
  let langs = (await axios().post('getLangs')).data // 다국어 메시지를 DB에서 가져오는 부분이므로 사용자 환경에 맞게 수정
  langs.map(x => {
    x.lang = JSON.parse(x.langJson)
    return x
  })
  let messages = {}
  let baseLangs = ['ko', 'en'] // 시스템에서 사용할 언어코드 목록
  let temp = _.groupBy(langs, 'categoryCd') 
  // {'common': [{categoryCd: 'common', code: 'requiredItem', lang: {ko: ..., en: ...}}], 'message': [{categoryCd: 'common', code: 'requiredItem', lang: {ko: ..., en: ...}}]}
  baseLangs.map(x => {
    messages[x] = {} // x = 'ko', 'en' 이므로 언어코드별 초기화 작업
    Object.keys(temp).map(y => {    // y = 'common', 'message'
      messages[x][y] = {} // 언어코드.categoryCd 별 초기화 작업 예) messages.ko.common = {}
      let value = _.mapValues(_.keyBy(temp[y], 'code'), 'lang') 
      //categoryCd가 'common'인 langJson을 가져옴
      Object.keys(value).map(z => { // x, y가 'ko', 'common' 일때 z = 'requiredItem'
        messages[x][y][z] = value[z][x] // 예) meassages.ko.common.requiredItem = '필수항목'
      })
    })
  })
  return new VueI18n({
    locale: 'ko', // 기본 locale
   fallbackLocale: 'ko',
   messages
  })
}

// DB 에서 다국어 메시지를 읽어오는 시차를 고려하여 promise then 으로 처리하여 다국어 코드가 누락되지 않도록 합니다.
setI18n()
  .then((i18n) => {
    new Vue({
      i18n,
      router,
      store,
      render: h => h(App)
    }).$mount('#app')
  })
```

#### messages에 값을 담는 방법
-  기존 json을 이용할때는 언어코드>category>code> value 구조로 되어있어 언어코드 별로 path를 읽어들였다면 db로 변경 후에는 cateogy>code>(언어코드>value) 구조로 되어 있어 처리하는 부분을 변경. 
- db column을 언어코드와 value를 분리하는 구성추천

#### new Vue 처리
- db 에서 값을 읽어와서 처리하는 부분에서 동기화 처리를 위해 setI18n function을 먼저 처리하고 then 부분에서 new Vue 처리.

  

# 6. Lodash

- 프론트 javascript 개발시 여러 페이지에서 공통으로 사용해야 하는 함수 또는 일반적인 유틸 함수들을 모아서 제공해주는 라이브러리
- javascript용 유틸리티 라이브러리로 가장 많이 쓰이는 최신의 기능을 제공.
- 배열, 숫자, 객체, 문자열 등의 데이터의 구조를 쉽게 변환하여 사용하는 함수제공.
- debounce나 throttle처럼 구현하기 번거로운 함수들을 제공. 
- _ 라는 기호를 사용하여 명칭이 lodash. 
- 배열에서 중복값을 제거할때, uniqBy, unionBy 메소드를 사용.
- 배열에서 원하는 객체 데이터를 추출할 때, find 메소드를 사용, 제거시 remove 메소드를 사용. 
- cloneDeep 메소드를 사용 깊은 복사가능

### 6-1. 설치
- npm으로 설치하기

```bash
  $ npm i -g npm
  $ npm i --save lodash
```

### 6-2. 사용법

```javascript
  var _ = require('lodash');
```
- _.함수명() 형태로 Lodash 라이브러리의 함수사용.

### 6-3. 대표메소드

#### uniqBy

- 배열 데이터 안의 값에서 중복 되는 값들을 제거한 후 반환.
- 배열 데이터가 하나일 때 사용.

```javascript
  _.uniqBy(배열 변수, '고유한 속성의 이름')
```

#### unionBy
- unioqBy와 비슷한 기능, uniqBy는 합친 후의 배열 데이터이고, unionBy는 합치기 전 배열의 데이터를 합쳐서, 중복 되는 값을 제거한 후 반환. 
- 배열 데이터가 여러개 일 때 사용. 

```javascript
  _.unionBy(배열 변수1, 배열 변수2, '고유한 속성의 이름')
```

```javascript
  // uniqBy, unionBy 예제
  const fruit1 = [
    { fruitId: 1, color: "yellow", name: "banana"}, 
    { fruitId: 2, color: "green", name: "apple" }
  ]
  const fruit2 = [
    { fruitId: 2, color: "green", name: "apple" }, 
    { fruitId: 3,color: "red", name: "strawberry" }
  ]

  const total = fruit1.concat(fruit2); //하나로 병합
  console.log('total', total);
  console.log('uniqBy', _.uniqBy(total, 'fruitId')); //중복 값 제거

  const fruit3 = _.unionBy(fruit1, fruit2, 'fruitId');
  console.log('unionBy', fruit3);
  //결과
  total (4) [{…}, {…}, {…}, {…}]
  0: {fruitId: 1, color: "yellow", name: "banana"}
  1: {fruitId: 2, color: "green", name: "apple"}
  2: {fruitId: 2, color: "green", name: "apple"}
  3: {fruitId: 3, color: "red", name: "strawberry"}
  length: 3
  uniqBy (3) [{…}, {…}, {…}]
  0: {fruitId: 1, color: "yellow", name: "banana"}
  1: {fruitId: 2, color: "green", name: "apple"}
  2: {fruitId: 3, color: "red", name: "strawberry"}
  length: 3
  unionBy (3) [{…}, {…}, {…}]
  0: {fruitId: 1, color: "yellow", name: "banana"}
  1: {fruitId: 2, color: "green", name: "apple"}
  2: {fruitId: 3, color: "red", name: "strawberry"}
  length: 3
```

#### find

- 배열 안에서 특정한 객체 데이터만 찾아서 반환. 

```javascript
  _.find(배열, { 찾을 객체 데이터 });
```

#### findIndex

- 배열 안에서 특정한 객체 데이터의 index를 반환. 

```javascript
  _.findIndex(배열, { 찾을 객체 데이터 });
```

#### find, findIndex 예제

```javascript
  const fruits = [
    { fruitId: 1, name: "banana"}, 
    { fruitId: 2, name: "apple" },
    { fruitId: 3, name: "strawberry"}, 
    { fruitId: 4, name: "melon"}, 
    { fruitId: 5, name: "kiwi" },
  ]

  const checkedFruit = _.find(fruits, {name: 'kiwi'});
  console.log('checkedFruit', checkedFruit);

  const checkedFruitIdx = _.findIndex(fruits, {name: 'kiwi'});
  console.log('checkedFruitIdx', checkedFruitIdx);

  //결과
  checkedFruit {fruitId: 5, name: "kiwi"}
  checkedFruitIdx 4
```

#### remove
- 배열에서 원하는 객체 데이터를 제거한 후 반환.

```javascript
  _.remove(배열, { 제거할 객체 데이터 });
```

```javascript
// remove 예제
  const fruits = [
    { fruitId: 1, name: "banana"}, 
    { fruitId: 2, name: "apple" },
    { fruitId: 3, name: "strawberry"}, 
    { fruitId: 4, name: "melon"}, 
    { fruitId: 5, name: "kiwi" },
  ]

  _.remove(fruits, {name: "melon"});
  console.log(fruits);
  //결과
  (4) [{…}, {…}, {…}, {…}]
  0: {fruitId: 1, name: "banana"}
  1: {fruitId: 2, name: "apple"}
  2: {fruitId: 3, name: "strawberry"}
  3: {fruitId: 5, name: "kiwi"}
  length: 4
```

#### cloneDeep
- 배열 안의 데이터를 깊은 복사하는 사용.

```javascript
  _.cloneDeep(value)
```

```javascript
  // cloneDeep 예제
  const objects = [{ 'a': 1 }, { 'b': 2 }];
  
  const deep = _.cloneDeep(objects);
  console.log(deep[0] === objects[0]);
  // => false 
```
  
  
# 7. webpack plugin

- plugin을 bundling되기 전이나 후에 파일을 custom하여 개발자가 원하는 기능을 추가.

### 7-1. ProvidePlugins
- 모든 모듈에서 사용할 수 있도록 해당 모듈을 변수로 변환. 
- 특정  모듈을 전역으로 사용할 수 있게 만든다는 의미. 

```json
// jquery를 $라는 변수로 전역으로 사용할 수 있게 만듦. 
  new webpack.ProvidePlugin({
    $:"jquery"
  })
```

### 7-2. DefinePlugins
- webpack 번들링을 시작하는 시점에서 필요한 상수들을 정의. 
  - 문자열, 숫자, true/false.

```json
  new webpack.DefinePlugin({
    PRODUCTION: JSON.stringfy(true),
    VERSION: JSON.stringfy(1.3),
  })
```

### 7-3. ManifestPlugin
- 번들링시 생성되는 코드에 대한 정보를 json 파일로 저장하여 관리 

```json
  new ManifestPlugin({
    fileName:'manifest.json',
    basePath:'./dist/'
  })
```

<details>
  <summary>Exp.</summary>  
  <pre>

// nuxt.config.js

```json
  import webpack from 'webpack'
  import initConfig from './config/index.js'

  const config = initConfig()
  const logger = require('./logger/server-log.js').default
  logger.info('✔✔✔ Nuxt server is started.')
  const target = config.args.static ? 'static' : 'server'
  logger.info('✔✔✔ Build target(server or static)?', target)
  logger.info('✔✔✔ Print process.env.NODE_ENV', process.env.NODE_ENV)
  logger.info('✔✔✔ Print process.env.VUE_APP_ENV', process.env.VUE_APP_ENV)
  logger.info('✔✔✔ Print process.env.API_BASE_URL', process.env.API_BASE_URL)

  export default {
    // Global page headers: https://go.nuxtjs.dev/config-head
    head: {
      title: 'XXXXX',
      htmlAttrs: {
        lang: 'ko'
      },
      meta: [
        { charset: 'utf-8' },
        { name: 'viewport', content: 'width=device-width, initial-scale=1' },
        { hid: 'description', name: 'description', content: '' },
        { hid: 'title', name: 'title', content: '' },
        { hid: 'keywords', name: 'keywords', content: '' },
        { hid: 'og-title', name: 'og:title', content: '' },
        { hid: 'og-description', name: 'og:description', content: '' },
        { hid: 'og-image', name: 'og:image', content: config.env.API_BASE_URL + '' },
        { hid: 'og-type', name: 'og:type', content: 'website' },
        { hid: 'twitter-card', name: 'twitter:card', content: 'summary_large_image' },
        { hid: 'twitter-title', name: 'twitter:title', content: '' },
        { hid: 'twitter-description', name: 'twitter:description', content: '' },
        { hid: 'twitter-image-src', name: 'twitter:image:src', content: config.env.API_BASE_URL + '' },
        { name: 'format-detection', content: 'telephone=no' }
      ],
      link: [{ rel: 'icon', type: 'image/x-icon', href: '/favicon.ico' }],
      script: [
        { src: '/mobile_redirect.js' },
        { src: '/static_mma_common.js' },
        { src: '//t1.daumcdn.net/adfit/static/kp.js', charset: 'utf-8' }
      ]
    },
    env: config.env,
    styleResources: {
      scss: ['@/assets/scss/_mixin.scss', '@/assets/scss/_variables.scss']
    },
    css: [

      '@/static/fonts/elementui/style.css',
      'element-ui/lib/theme-chalk/index.css',
      'quill/dist/quill.core.css',
      // for snow theme
      'quill/dist/quill.snow.css',
      // for bubble theme
      'quill/dist/quill.bubble.css',
      'swiper/dist/css/swiper.css'
    ],
    loading: '~/components/loading.vue',
    // Plugins to run before rendering page: https://go.nuxtjs.dev/config-plugins
    plugins: [
      '@/plugins/element-ui',
      { src: '~/plugins/element-ui.js' },
      { src: '~/plugins/common/validation/validation.js' },
      { src: '~/plugins/common/vuex/vuex-helper.js' },
      { src: '~/plugins/persistedState.client.js' },
      { src: '@/plugins/common/tui-grid-client', ssr: false, mode: 'client' },
      { src: '@/plugins/axios/axios-builder.js' },
      { src: '~/plugins/common/quill-editor.js', ssr: false },
      { src: './plugins/vue-awesome-swiper.js', ssr: false },
      { src: '@/plugins/lodash' },
      { src: './plugins/filters/index.js', ssr: false },
      { src: './plugins/groobeeResponse.js', ssr: false },
      { src: './plugins/he.js' }
    ],
    // Auto import components: https://go.nuxtjs.dev/config-components
    components: true,
    // Modules for dev and build (recommended): https://go.nuxtjs.dev/config-modules
    buildModules: [
      '@nuxtjs/eslint-module',
      '@nuxtjs/device',
      '@nuxtjs/gtm',
      ['@nuxtjs/dotenv', {}],
      ['cookie-universal-nuxt', { alias: 'cookiz' }],
      '@nuxtjs/style-resources'
    ],
    router: {
      middleware: 'token'
    },
    // Modules: https://go.nuxtjs.dev/config-modules
    modules: [
      '@nuxtjs/axios'
      // '@nuxtjs/i18n'
    ],

    i18n: {
      locales: ['ko', 'en'],
      defaultLocale: 'ko',
      vueI18n: {
        fallbackLocale: 'ko'
      }
    },
    gtm: {
      enabled: true,
      debug: true,
      id: 'GTM-NXZPHVG',
      layer: 'dataLayer',
      pageTracking: true,
      autoInit: true
    },
    // Axios module configuration: https://go.nuxtjs.dev/config-axios
    axios: { baseURL: process.env.API_BASE_URL, credentials: true },
    // Build Configuration: https://go.nuxtjs.dev/config-build
    build: {
      transpile: [/^element-ui/, 'vee-validate/dist/rules'],
      plugins: [
        new webpack.ProvidePlugin({
          $: 'jquery',
          jQuery: 'jquery',
          'window.jQuery': 'jquery'
        })
      ]
    },
    server: {
      port: 1111
    },
    telemetry: false
}
```

  </pre>
</details>